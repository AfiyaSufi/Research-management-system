{% extends 'base.html' %}

{% block title %}External Evaluator Form{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-clipboard-check"></i> External Evaluator Form</h3>
                </div>
                <div class="card-body">
                    {% if error %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle"></i> {{ error }}
                        </div>
                    {% elif success %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> <strong>Success!</strong> {{ success }}
                            <hr>
                            <p class="mb-2">Your evaluation has been recorded successfully.</p>
                            <p class="mb-0 text-muted small">You can now close this page.</p>
                        </div>
                    {% else %}
                        <!-- Evaluator Info -->
                        <div class="mb-4 p-3 bg-light rounded">
                            <h5 class="text-primary mb-3">Evaluator Information</h5>
                            <p><strong>Name:</strong> {{ evaluator.name }}</p>
                            <p><strong>Email:</strong> {{ evaluator.email }}</p>
                            <p class="mb-0"><strong>Participant:</strong> {{ evaluator.participant_name }}</p>
                        </div>

                        <!-- Proposal Details -->
                        <div class="mb-4 p-3 border rounded">
                            <h5 class="text-primary mb-3">Proposal Details</h5>
                            <p><strong>Title:</strong> {{ evaluator.proposal_title }}</p>
                            <p><strong>Description:</strong></p>
                            <p class="text-muted">{{ evaluator.proposal_description }}</p>
                            {% if evaluator.proposal_file_url %}
                                <a href="{{ evaluator.proposal_file_url }}" class="btn btn-outline-primary btn-sm" target="_blank">
                                    <i class="fas fa-file-pdf"></i> Download Proposal
                                </a>
                            {% endif %}
                        </div>

                        <!-- Evaluation Form -->
                        <form method="POST" id="evaluationForm">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label for="marks" class="form-label">Marks (0-100) <span class="text-danger">*</span></label>
                                <input type="number" 
                                       class="form-control" 
                                       id="marks" 
                                       name="marks" 
                                       min="0" 
                                       max="100" 
                                       step="0.01"
                                       required
                                       placeholder="Enter marks out of 100">
                                <div class="form-text">
                                    <strong>Note:</strong> Minimum average of 65 marks is required for the proposal to proceed.
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="comments" class="form-label">Comments</label>
                                <textarea class="form-control" 
                                          id="comments" 
                                          name="comments" 
                                          rows="5" 
                                          placeholder="Enter your evaluation comments (optional)"></textarea>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                    <i class="fas fa-paper-plane"></i> Submit Evaluation
                                </button>
                            </div>
                        </form>

                        <!-- Status Info -->
                        <div class="mt-3 text-muted small">
                            <p class="mb-1"><strong>Status:</strong> {{ evaluator.status }}</p>
                            <p class="mb-0"><strong>Expires at:</strong> {{ evaluator.expires_at|date:"F d, Y H:i" }}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border: none;
        border-radius: 10px;
    }
    .card-header {
        border-radius: 10px 10px 0 0 !important;
    }
</style>
{% endblock %}
